{"code":"app.title = '堆叠条形图';\nconst xdata = ['2018/05/06','2018/05/06','2018/05/06','2018/05/06','2018/05/06','2018/05/06','2018/05/06'];\nconst ydata = {\n    energy: [320, 302, 301, 334, 390, 330, 320],\n    other: [120, 132, 101, 134, 90, 230, 210],\n};\nconst toPercent = (num1, num2) => {\n    const total = num1 + num2;\n    return (Math.round(num1 / total * 10000) / 100).toFixed(0) + '%';\n};\nconst formatDate = (date, format = 'YYYY/MM/DD') => {\n    if (!date) return '';\n\n    const time = typeof date === 'string' ? new Date(date) : date;\n    const year = time.getFullYear(),\n    month = time.getMonth() + 1,\n    day = time.getDate(),\n    hour = time.getHours(),\n    min =  time.getMinutes(),\n    sec = time.getSeconds();\n    const preIndex = Array.apply(null, Array[10]).map((elem, index) => {return `0${index}`});\n    return format.replace(/YYYY/g, year)\n    .replace(/MM/g, preIndex[month] || month)\n    .replace(/DD/g, preIndex[day] || day)\n    .replace(/hh/g, preIndex[hour] || hour)\n    .replace(/mm/g, preIndex[min] || min)\n    .replace(/ss/g, preIndex[sec] || sec);\n}\nlet sum = [];\n\n$.each(ydata.energy, (index, cur) => {\n    sum[index] = cur + ydata.other[index];\n})\n\n\noption = {\n    tooltip : {\n        trigger: 'axis',\n        axisPointer : {            // 坐标轴指示器，坐标轴触发有效\n            type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'\n        },\n        formatter: function (params) {\n            let p1 = toPercent(params[1].data, params[0].data);\n            let p2 = toPercent(params[0].data, params[1].data);\n            let date = formatDate(params[1].axisValueLabel, 'YYYY年MM月DD日')\n            return `\n                ${date} <br/>\n                ${params[1].marker} ${params[1].seriesName}：${params[1].data}个 （${p1}）<br/>\n                ${params[0].marker} ${params[0].seriesName}：${params[0].data}个 （${p2}）<br/>\n            `\n        },\n    },\n    legend: {\n        data: ['电源箱警报', '其他运行设备警报']\n    },\n    grid: {\n        left: '3%',\n        right: '4%',\n        bottom: '7%',\n        containLabel: true,\n    },\n    xAxis: {\n        type: 'category',\n        data: xdata,\n        axisLine: {\n            lineStyle: {\n                color: '#999',\n            }\n        },\n        axisLabel: {\n            color: '#999',\n        }\n    },\n    yAxis:  {\n        type: 'value',\n        name: '单位/个',\n        axisLine: {\n            lineStyle: {\n                color: '#999',\n            }\n        },\n        splitLine: {\n            lineStyle: {\n                color: '#999',\n            },\n        },\n        axisLabel: {\n            color: '#999',\n        }\n    },\n    dataZoom:[\n      {\n          id: 'dataZoomX',\n          type: 'slider',\n          xAxisIndex: [0],\n          filterMode: 'filter',\n      },\n      {\n          type: 'inside',\n      },\n    ],\n    series: [\n        {\n            name: '其他运行设备警报',\n            type: 'bar',\n            stack: '当天报警总数',\n            data: ydata.other,\n            itemStyle: {\n                color: '#4acffa',\n            }\n        },\n        {\n            name: '电源箱警报',\n            type: 'bar',\n            stack: '当天报警总数',\n            data: ydata.energy,\n            itemStyle: {\n              color: '#fa8c69',\n            },\n        },\n        {\n            name: '总报警数',\n            type: 'bar',\n            barGap: '-100%',\n            data: sum,\n            show: false,\n            itemStyle: {\n              color: 'transparent',\n            },\n            label: {\n              show: true,\n              position: 'top',\n              color: '#999',\n            }\n        },\n    ]\n};"}