{"code":"let data = [],\r\n    typs = [],\r\n    sourceData = [{\r\n        \"source\": 0,\r\n        \"source_name\": \"无\",\r\n        \"count\": 4,\r\n        \"percent\": null\r\n    }, {\r\n        \"source\": 1,\r\n        \"source_name\": \"一体机邀约\",\r\n        \"count\": 6,\r\n        \"percent\": null\r\n    }, {\r\n        \"source\": 2,\r\n        \"source_name\": \"速检通邀约\",\r\n        \"count\": 9,\r\n        \"percent\": null\r\n    }, {\r\n        \"source\": 3,\r\n        \"source_name\": \"问卷邀约\",\r\n        \"count\": 8,\r\n        \"percent\": null\r\n    }, {\r\n        \"source\": 7,\r\n        \"source_name\": \"手动添加\",\r\n        \"count\": 4,\r\n        \"percent\": null\r\n    }, {\r\n        \"source\": 8,\r\n        \"source_name\": \"抖音客户来源\",\r\n        \"count\": 0,\r\n        \"percent\": null\r\n    }, {\r\n        \"source\": 9,\r\n        \"source_name\": \"服务卡邀约\",\r\n        \"count\": 13,\r\n        \"percent\": null\r\n    }, {\r\n        \"source\": 10,\r\n        \"source_name\": \"心电邀约\",\r\n        \"count\": 0,\r\n        \"percent\": null\r\n    }, {\r\n        \"source\": -10,\r\n        \"source_name\": \"散客\",\r\n        \"count\": 0,\r\n        \"percent\": null\r\n    }];\r\n\r\n//- 数据格式化\r\nsourceData.forEach((o) => {\r\n\r\n    if (o.count > 0) {\r\n        data.push(o.count);\r\n        typs.push(o.source_name);\r\n    }\r\n\r\n})\r\n\r\nlet count = data.reduce(function(prev, curr, idx, arr) {\r\n        return prev + curr;\r\n    }),\r\n\r\n    rich = {\r\n        b: {\r\n            fontSize: 16,\r\n            padding: [20, 0, -20, 0],\r\n        },\r\n        d: {\r\n            fontSize: 14,\r\n            fontWeight: 100,\r\n            padding: [2, 0, 0, 0]\r\n        }\r\n    },\r\n    label = {\r\n        normal: {\r\n            show: true\r\n        }\r\n    },\r\n    itemStyle = {\r\n        barBorderRadius: 10\r\n    },\r\n\r\n    formatSeries = () => {\r\n        let arr = []\r\n        typs.forEach((o, i) => {\r\n            arr.push({\r\n                name: o,\r\n                type: 'bar',\r\n                stack: 'income',\r\n                barWidth: 10,\r\n                label: label,\r\n                labelLine: {\r\n                    normal: {\r\n                        show: true,\r\n                        length: 90,\r\n                        length2: 45,\r\n                        smooth: true,\r\n                    }\r\n                },\r\n                itemStyle: itemStyle,\r\n                data: [{\r\n                    value: data[i],\r\n                    label: {\r\n                        normal: {\r\n                            offset: [0, 0],\r\n                            position: 'center',\r\n                            formatter: [\r\n                                '{b|' + o + '}',\r\n                                '{d|新客:' + data[i] + '}',\r\n                                '{d|占比:' + (data[i] / count * 100).toFixed(\r\n                                    1) + '%}'\r\n                            ].join('\\n'),\r\n                            rich: rich\r\n                        }\r\n                    }\r\n                }]\r\n            })\r\n        })\r\n\r\n        return arr;\r\n    };\r\n\r\noption = {\r\n    tooltip: {\r\n        trigger: 'item',\r\n        formatter: function(params) {\r\n            let res = params.seriesName + '</br>新客：' + params.value + '</br>占比：' + (params.value /\r\n                count * 100).toFixed(1) + '%';\r\n            return res;\r\n        }\r\n    },\r\n    xAxis: [{\r\n        type: 'value',\r\n        show: false,\r\n        max: count, // 居中显示\r\n    }],\r\n    yAxis: [{\r\n        type: 'category',\r\n        show: false,\r\n    }],\r\n    legend: {\r\n        show: true,\r\n        top: 'top',\r\n        textStyle: {\r\n            fontSize: 12,\r\n            color: '#c8c8c8'\r\n        },\r\n    },\r\n    color: ['#618cff', '#ffa57c', '#fb7636', '#24b314', '#8452e7', '#00d3e2'],\r\n    series: formatSeries(),\r\n\r\n}"}