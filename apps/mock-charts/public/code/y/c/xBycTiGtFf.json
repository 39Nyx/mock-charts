{"code":"//关于这个图表我做的视频简介：https://www.bilibili.com/video/BV1pD4y127tW\n//各位观众老爷们一键三连，下次一定！\n\nvar MapboxStyleDataURL = \"/asset/get/s/data-1522488401196-HJYUN03qz.json\";//自定义mapbox的style，使其标签为中文\n\nvar uploadedDataURL = \"/asset/get/s/data-1521463392670-HkYvx4TtG.json\";//原始数据为栅格数据，需将栅格转化为经纬度后可视化\n\n//mapboxgl.accessToken = mapboxglToken;\n\nmyChart.showLoading();\n\nfunction coltowgs(LONCOL, LATCOL) {//定义栅格转换经纬度的函数\n    var lat1 = 30.6666667;\n    var lat2 = 31.8833333;\n    var lon1 = 120.866667;\n    var lon2 = 122.2;\n    var accuracy = 500;\n    var latStart = Math.min(lat1, lat2);\n    var lonStart = Math.min(lon1, lon2);\n    var deltaLon = accuracy * 360 / (2 * Math.PI * 6371004 * Math.cos((lat1 + lat2) * Math.PI / 360));\n    var deltaLat = accuracy * 360 / (2 * Math.PI * 6371004);\n    var HBLON = LONCOL * deltaLon + (lonStart - deltaLon / 2)\n    var HBLAT = LATCOL * deltaLat + (latStart - deltaLat / 2)\n    return [HBLON, HBLAT]\n}\n$.getJSON(MapboxStyleDataURL, function(MapboxStyle) {//读取MapboxStyle数据\nvar option = {\n    baseOption: {\n        timeline: {\n            axisType: 'category',\n            orient: 'vertical',\n            autoPlay: true,\n            inverse: true,\n            playInterval: 1000,\n            left: null,\n            right: 0,\n            top: null,\n            bottom: 50,\n            width: 55,\n            height: null,\n            label: {\n                normal: {\n                    textStyle: {\n                        color: '#fff'\n                    }\n                },\n                emphasis: {\n                    textStyle: {\n                        color: '#aaa'\n                    }\n                }\n            },\n            symbol: 'circle',\n            lineStyle: {\n                color: '#555'\n            },\n            checkpointStyle: {\n                color: '#bbb',\n                borderColor: '#777',\n                borderWidth: 2\n            },\n            controlStyle: {\n                normal: {\n                    color: '#666',\n                    borderColor: '#666'\n                },\n                emphasis: {\n                    color: '#aaa',\n                    borderColor: '#aaa'\n                }\n            },\n            data: []\n        },\n        title: {\n            text: \"上海居民活动点分布可视化\",\n            textStyle: {\n                color: '#fff',\n                fontSize: 30\n            },\n            right: '5%'\n        },\n\n        visualMap: {\n            show: false,\n            calculable: true,\n            realtime: false,\n            inRange: {\n                color: ['#313695', '#4575b4', '#74add1', '#abd9e9', '#e0f3f8', '#ffffbf', '#fee090', '#fdae61', '#f46d43', '#d73027', '#a50026']\n            },\n            outOfRange: {\n                colorAlpha: 0\n            }\n\n        },\n\n\n            maptalks3D: {\n                  center: [121.4693, 31.213070],\n                zoom: 10,\n                pitch: 40,\n                urlTemplate: 'http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png',\n                // altitudeScale: 1,\n                postEffect: {\n                    enable: true,\n                    FXAA: {\n                        enable: true\n                    }\n                },\n                light: {\n                    main: {\n                        intensity: 1,\n                        shadow: true,\n                        shadowQuality: 'high'\n                    },\n                    ambient: {\n                        intensity: 0.\n                    },\n                    ambientCubemap: {\n                        texture: '/asset/get/s/data-1491838644249-ry33I7YTe.hdr',\n                        exposure: 1,\n                        diffuseIntensity: 0.5,\n                        specularIntensity: 2\n                    }\n                }\n            },\n        series: [{\n            type: 'bar3D',\n            shading: 'realistic',\n            coordinateSystem: 'maptalks3D',\n            barSize: 0.5,\n            silent: true\n        }]\n    },\n    options: []//timeline所用的多个option存放处，读取数据后添加\n}\n\n$.getJSON(uploadedDataURL, function(linedata) {//读取可视化数据\n    myChart.hideLoading();\n    \n    for (var n = 0; n < linedata[0].length; n++) {//对数据中每天数据整理后添加到options中，以便timeline使用\n        option.baseOption.timeline.data.push(linedata[2][n]);\n        timedata = linedata[0][n]\n        var data = []\n        for (var i = 0; i < timedata.length; i += 1) {\n            loncol = linedata[0][n][i][0]\n            latcol = linedata[0][n][i][1]\n            count = linedata[0][n][i][2]\n            coor = coltowgs(loncol, latcol)\n            data.push({\n                'value': [coor[0], coor[1], count]\n            })\n        }\n        data.push({\n            'value': [120, 30, linedata[1]]\n        })\n        option.options.push({\n\n            visualMap: {\n                max: linedata[1]\n            },\n            series: [{\n                data: data\n            }]\n        });\n    }\n\n    if (option && typeof option === \"object\") {\n        myChart.setOption(option, true);\n    }\n});\n});"}